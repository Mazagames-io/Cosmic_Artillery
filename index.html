<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="Interactive water simulation with realistic ripples and wave effects using WebGL shaders"
    />
    <title>Interactive Water Simulation - Realistic Ripple Effects</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <!-- Canvas for cannon and projectiles -->
    <canvas id="cannonCanvas"></canvas>
    
    <!-- Overlay content -->
    <div class="content-overlay">
        <h1 class="title">Cosmic Artillery</h1>
        <p class="subtitle">Click to fire bullets â€¢ Right-click for homing rockets</p>
        <div class="stats-display">
            <span id="bulletCount">Bullets: 0</span>
            <span id="rocketCount">Rockets: 0</span>
        </div>
    </div>

    <!-- WebGL shader scripts -->
    <script id="vertexShader" type="x-shader/x-vertex">
      attribute vec2 a_position;
      varying vec2 v_uv;

      void main() {
          v_uv = a_position * 0.5 + 0.5;
          gl_Position = vec4(a_position, 0.0, 1.0);
      }
    </script>

    <script id="fragmentShader" type="x-shader/x-fragment">
      precision highp float;

      uniform float u_time;
      uniform vec2 u_resolution;
      uniform vec2 u_mouse;
      uniform float u_mouseInfluence;

      varying vec2 v_uv;

      // Noise function for organic water movement
      float noise(vec2 p) {
          return fract(sin(dot(p, vec2(12.9898, 78.233))) * 43758.5453);
      }

      // Smooth noise
      float smoothNoise(vec2 p) {
          vec2 i = floor(p);
          vec2 f = fract(p);
          f = f * f * (3.0 - 2.0 * f);

          float a = noise(i);
          float b = noise(i + vec2(1.0, 0.0));
          float c = noise(i + vec2(0.0, 1.0));
          float d = noise(i + vec2(1.0, 1.0));

          return mix(mix(a, b, f.x), mix(c, d, f.x), f.y);
      }

      // Fractal Brownian Motion for detailed water texture
      float fbm(vec2 p) {
          float value = 0.0;
          float amplitude = 0.5;
          float frequency = 1.0;

          for(int i = 0; i < 5; i++) {
              value += amplitude * smoothNoise(p * frequency);
              frequency *= 2.0;
              amplitude *= 0.5;
          }

          return value;
      }

      // Calculate ripple effect from mouse interaction
      float ripple(vec2 uv, vec2 center, float time) {
          float dist = length(uv - center);
          float rippleSpeed = 2.5;
          float rippleFrequency = 20.0;
          float rippleDecay = 3.0;

          float wave = sin(dist * rippleFrequency - time * rippleSpeed) *
                      exp(-dist * rippleDecay);

          return wave;
      }

      void main() {
          // Normalize coordinates
          vec2 uv = gl_FragCoord.xy / u_resolution.xy;
          vec2 aspectUv = uv;
          aspectUv.x *= u_resolution.x / u_resolution.y;

          // Base water movement
          float time = u_time * 0.3;
          vec2 flowDirection = vec2(0.3, 0.5);
          vec2 flowingUv = aspectUv + flowDirection * time * 0.05;

          // Create flowing water texture with multiple layers
          float water1 = fbm(flowingUv * 3.0 + time * 0.1);
          float water2 = fbm(flowingUv * 5.0 - time * 0.15);
          float waterPattern = (water1 + water2) * 0.5;

          // Add gentle waves
          float wave1 = sin(aspectUv.x * 8.0 + time) * 0.5 + 0.5;
          float wave2 = sin(aspectUv.y * 6.0 - time * 0.8) * 0.5 + 0.5;
          float waves = (wave1 + wave2) * 0.5;

          // Combine all effects (no mouse ripples)
          float distortion = waterPattern * 0.1 + waves * 0.05;
          vec2 distortedUv = uv + vec2(distortion);

          // Create depth effect
          float depth = smoothNoise(distortedUv * 4.0 + time * 0.1);
          depth = mix(0.3, 1.0, depth);

          // Water color palette - beautiful blue-green gradient
          vec3 deepWater = vec3(0.02, 0.15, 0.3);      // Deep blue
          vec3 shallowWater = vec3(0.1, 0.4, 0.5);     // Cyan-blue
          vec3 surfaceWater = vec3(0.2, 0.6, 0.65);    // Light turquoise

          // Mix colors based on depth and distortion
          vec3 waterColor = mix(deepWater, shallowWater, depth);
          waterColor = mix(waterColor, surfaceWater, waterPattern);

          // Add subtle shimmer
          float shimmer = smoothNoise(aspectUv * 20.0 + time * 2.0);
          shimmer = smoothstep(0.6, 0.8, shimmer);
          waterColor += shimmer * 0.1;

          // Vignette effect for depth
          float vignette = 1.0 - length(uv - 0.5) * 0.5;
          waterColor *= vignette;

          gl_FragColor = vec4(waterColor, 1.0);
      }
    </script>

    <script src="cannon.js"></script>
  </body>
</html>
